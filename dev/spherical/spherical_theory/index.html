<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Spherical Vector Wave Expansion · AntennaFieldRepresentations.jl</title><meta name="title" content="Spherical Vector Wave Expansion · AntennaFieldRepresentations.jl"/><meta property="og:title" content="Spherical Vector Wave Expansion · AntennaFieldRepresentations.jl"/><meta property="twitter:title" content="Spherical Vector Wave Expansion · AntennaFieldRepresentations.jl"/><meta name="description" content="Documentation for AntennaFieldRepresentations.jl."/><meta property="og:description" content="Documentation for AntennaFieldRepresentations.jl."/><meta property="twitter:description" content="Documentation for AntennaFieldRepresentations.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="AntennaFieldRepresentations.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="AntennaFieldRepresentations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AntennaFieldRepresentations.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Antenna Field Representations</span><ul><li><a class="tocitem" href="../../fieldrepresentations/">General Field Representation Interface</a></li><li><a class="tocitem" href="../../dipoles/dipole_representations/">Dipole Representations</a></li><li><a class="tocitem" href="../spherical_representations/">Spherical Mode Representations</a></li><li><a class="tocitem" href="../../planewaves/planewave_representations/">Plane Wave Representations</a></li><li><a class="tocitem" href="../../surfacecurrents/surface_representations/">Equivalent Surface Currents</a></li></ul></li><li><span class="tocitem">Field Samplings</span><ul><li><a class="tocitem" href="../../sampling/fieldsamplings/">General Field Sampling Interface</a></li><li><a class="tocitem" href="../../sampling/irregularsampling/">Irregularly Distributed Field Samplings</a></li><li><a class="tocitem" href="../../sampling/sphericalsampling/">Spherical Field Samplings</a></li><li><a class="tocitem" href="../../sampling/farfieldsampling/">Far Field Samplings</a></li></ul></li><li><span class="tocitem">Operations</span><ul><li><a class="tocitem" href="../../operations/operationmaps/">OperationMaps</a></li><li><a class="tocitem" href="../../operations/coordinate_trafos/">Coordinate Transformations</a></li><li><a class="tocitem" href="../../operations/conversions/">Conversion into Other Field Representations</a></li><li><a class="tocitem" href="../../operations/transmission/">Transmission</a></li></ul></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><span class="tocitem">Electromagnetic Theory</span><ul><li><a class="tocitem" href="../../dipoles/dipole_theory/">Dipoles</a></li><li class="is-active"><a class="tocitem" href>Spherical Vector Wave Expansion</a><ul class="internal"><li><a class="tocitem" href="#spherical_definition"><span>Definition of Spherical Vector-Mode Functions</span></a></li><li><a class="tocitem" href="#spherical_orthogonality"><span>Orthogonality Relations of Spherical Vector-Mode Functions</span></a></li><li><a class="tocitem" href="#spherical_farfield"><span>Far-Field Expressions</span></a></li><li><a class="tocitem" href="#Spherical-Expansion-Coefficients-from-a-Current-Density"><span>Spherical Expansion Coefficients from a Current Density</span></a></li><li><a class="tocitem" href="#spherical_coefficients_orthogonality"><span>Spherical Expansion Coefficients by Using Orthogonality</span></a></li><li><a class="tocitem" href="#spherical_incident_expansion"><span>Number of Relevant Modes of an Incident Electromagnetic Field</span></a></li><li><a class="tocitem" href="#spherical_translation"><span>Translation of Radiated Modes into Incident Modes in Different Coordinate System</span></a></li><li><a class="tocitem" href="#Received-Signal"><span>Received Signal</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../../planewaves/planewave_theory/">Plane Wave Expansion</a></li><li><a class="tocitem" href="../../surfacecurrents/surface_theory/">Equivalent Surface Currents</a></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">Fast Algorithms</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spherical_fast/">Spherical Wacker Algorithm</a></li><li><a class="tocitem" href="../../mlfmm/mlfmm_theory/">Multilevel Fast Multipole Method</a></li></ul></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Electromagnetic Theory</a></li><li class="is-active"><a href>Spherical Vector Wave Expansion</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Spherical Vector Wave Expansion</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="sphericalexpansion"><a class="docs-heading-anchor" href="#sphericalexpansion">Spherical Vector-Wave Expansion of General Time Harmonic Electromangentic Fields</a><a id="sphericalexpansion-1"></a><a class="docs-heading-anchor-permalink" href="#sphericalexpansion" title="Permalink"></a></h1><p>Away from sources, the time harmonic electric and magnetic fields must fulfill the homogeneous curl-curl-equation </p><p class="math-container">\[\nabla \times \nabla \times \bm{E} - k_0^2 \bm{E} =\bm{0}\, .\]</p><p>Arbitrary source-free solutions of Maxwell&#39;s equations can be expanded into a series of spherical vector-wave functions as (see pp. 9ff of <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>)</p><p class="math-container">\[\bm{E}(r, \vartheta, \varphi) =
k_0 \, \sqrt{Z_{\mathrm{F}}}
\sum \limits_{c}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{\infty}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(c)}\,
\bm{F}_{s\ell m}^{(c)}(r,\vartheta, \varphi)\]</p><p class="math-container">\[\bm{H}(r, \vartheta, \varphi) =\mathrm{j}\,
\dfrac{k_0}{\sqrt{Z_{\mathrm{F}}}}
\sum \limits_{c}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{\infty}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(c)}\,
\bm{F}_{3-s,\ell m}^{(c)}(r,\vartheta, \varphi)\]</p><p>where <span>$Z_{\mathrm{F}}\sqrt{\mu_0/ \varepsilon_{0}}\approx 376.730\,313\,669\, \mathrm{\Omega}$</span> is the impedance of free space and <span>$\bm{F}_{s\ell m}^{(c)}(r,\vartheta, \varphi)$</span> are the spherical vector wave mode functions, which are solutions to the homogeneous curl-curl equation (except in the origin of the coordinate system, where some types of vector mode functions become singular). Due to only two of the radial dependencies being linearly independent, it is sufficient to let the sum over <span>$c$</span> to be an arbitrary pair of two iindices from the set <span>$c \in \{1,2,3,4\}$</span>. Usually one will choose the pair <span>$c=1$</span> and <span>$c=4$</span>, where only the <span>$c=4$</span>-type modes are needed to describe purely radiated fields and only the <span>$c=1$</span>-type modes are needed to describe purely incident fields.</p><p>The vector of coefficients completely defines the fields of a corresponding radiating or incident spherical wave expansion. </p><h2 id="spherical_definition"><a class="docs-heading-anchor" href="#spherical_definition">Definition of Spherical Vector-Mode Functions</a><a id="spherical_definition-1"></a><a class="docs-heading-anchor-permalink" href="#spherical_definition" title="Permalink"></a></h2><p>Explicit expressions for the spherical vector-mode functions are (see p. 13 of <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>)</p><p class="math-container">\[\bm{F}_{1\,\ell m}^{(c)}(r,\vartheta, \varphi)
=
\dfrac{\mathrm{e}^{\, \mathrm{j}m\varphi}}{\sqrt{2}\pi}
\left(
\dfrac{z_\ell^{(c)}(k_0r)}{\sqrt{\ell(\ell+1)}} \, \dfrac{\mathrm{j}m \,\overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) }{\sin \vartheta} \bm{e}_\vartheta
-\dfrac{z_\ell^{(c)}(k_0r)}{\sqrt{\ell(\ell+1)}} \, \dfrac{\mathrm{d}\,\overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) }{\mathrm{d} \vartheta} \bm{e}_\varphi
\right)\]</p><p class="math-container">\[\bm{F}_{2\,\ell m}^{(c)}(r,\vartheta, \varphi)
=
\dfrac{\mathrm{e}^{\, \mathrm{j}m\varphi}}{\sqrt{2}\pi}
\left(
\dfrac{\sqrt{\ell(\ell+1)}}{k_0r}\, z_\ell^{(c)}(k_0r)\, \overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) \bm{e}_r
\right.
\phantom{\dfrac{\mathrm{d}\,\overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) }{\mathrm{d} \vartheta}~~~~~}
\\
\phantom{\bm{F}_{2\,\ell m}^{(c)}(r,\vartheta, \varphi)
=
\dfrac{\mathrm{e}^{\, \mathrm{j}m\varphi}}{\sqrt{2}\pi}}
+ \dfrac{1}{k_0r} \dfrac{\mathrm{d}}{\mathrm{d} k_0r} \left\{k_0 r \dfrac{z_\ell^{(c)}(k_0r)}{\sqrt{\ell(\ell+1)}} \right\}\, \dfrac{\mathrm{d}\,\overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) }{\mathrm{d} \vartheta} \bm{e}_\vartheta
\phantom{~~~~~}
\\ \left.
\phantom{\bm{F}_{2\,\ell m}^{(c)}(r,\vartheta, \varphi)
=
\dfrac{\mathrm{e}^{\, \mathrm{j}m\varphi}}{\sqrt{2}\pi}}
+ \dfrac{1}{k_0r} \dfrac{\mathrm{d}}{\mathrm{d} k_0r} \left\{k_0 r \dfrac{z_\ell^{(c)}(k_0r)}{\sqrt{\ell(\ell+1)}} \right\}\, \dfrac{\mathrm{j}m \,\overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) }{\sin \vartheta} \bm{e}_\varphi\
\right)\, .\]</p><p>To ensure that the vector-mode functions <span>$\bm{F}_{s\ell m}^{(c)}(r,\vartheta, \varphi)$</span> are solutions to the homogeneous curl-curl equation, they are constructed from solutions of the homogeneous scalar Helmholtz equation as (see, e.g., page 393 of <sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup>)</p><p class="math-container">\[\bm{M}_{\ell m}^{(c)}= \nabla f_{\ell m}^{(c)} \times \bm{e}_r \overset{!}{=} \bm{F}_{1\,\ell m}^{(c)}\]</p><p>and</p><p class="math-container">\[\bm{N}_{\ell m}^{(c)}= \dfrac{1}{k_0} \nabla \times \bm{M}_{\ell m}^{(c)} \overset{!}{=} \bm{F}_{2\,\ell m}^{(c)}\]</p><p>where <span>$\bm{e}_r$</span> is the unit vector in radial direction.</p><p>General solution to the scalar Helmholtz equation </p><p class="math-container">\[\Delta f +k_0^2 f=0\, .\]</p><p>can be constructed as superpositions of functions from the set</p><p class="math-container">\[f_{s\ell m}^{(c)}(r, \vartheta, \varphi)
=
\begin{cases}
\dfrac{\mathrm{j}_{\ell}(k_0 r)}{\sqrt{\ell(\ell+1)}}
\, \mathrm{Y}_{\ell m}(\vartheta, \varphi) &amp; c=1\\[1.5em]
\dfrac{\mathrm{\mathrm{n}}_\ell(k_0 r)}{\sqrt{\ell(\ell+1)}}
\, \mathrm{Y}_{\ell m}(\vartheta, \varphi) &amp; c=2\\[1.5em]
\dfrac{\mathrm{\mathrm{h}}_\ell^{(1)}(k_0 r)}{\sqrt{\ell(\ell+1)}}
\, \mathrm{Y}_{\ell m}(\vartheta, \varphi) &amp; c=3\\[1.5em]
\dfrac{\mathrm{\mathrm{h}}_\ell^{(2)}(k_0 r)}{\sqrt{\ell(\ell+1)}}\,
 \mathrm{Y}_{\ell m}(\vartheta, \varphi) &amp; c=4
\end{cases} \]</p><p>where </p><ul><li><span>$\mathrm{j}_{\ell}(k_0 r)$</span> are spherical Bessel functions which represent the radial behavior standing waves (or <em>incident</em> waves)</li><li><span>$\mathrm{n}_{\ell}(k_0 r)$</span> are spherical Neumann functions which usually do not represent a physically meaningful solution</li><li><span>$\mathrm{h}_\ell^{(1)}(k_0 r) = \mathrm{j}_{\ell}(k_0 r) +\mathrm{j}\, \mathrm{n}_{\ell}(k_0 r)$</span> are spherical Hankel functions of first kind which represent the radial behavior of waves coming from infinity being absorbed at the coordinate origin</li><li><span>$\mathrm{h}_\ell^{(2)}(k_0 r) = \mathrm{j}_{\ell}(k_0 r) -\mathrm{j}\, \mathrm{n}_{\ell}(k_0 r)$</span> are spherical Hankel functions of second kind which represent the radial behavior of waves traveling from the coordinate origin toward infinity</li><li><span>$\mathrm{Y}_{\ell m}(\vartheta, \varphi)$</span> are the spherical Harmonics</li></ul><p>and <span>$k_0=2\pi/\lambda$</span> is the wavenumber defined by the frequency of the electromagnetic wave.</p><p>The spherical Harmonics are defined as (see §14.30 of <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>)</p><p class="math-container">\[\mathrm{Y}_{\ell m}(\vartheta, \varphi) 
=
\begin{cases}
\dfrac{1}{\sqrt{2\pi}}\, \overline{\mathrm{P}}_{\ell}^{m}(\cos \vartheta) \mathrm{e}^{\, \mathrm{j}m \varphi} &amp; \text{for }|m|\leq \ell\\
0 &amp; \text{esle}
\end{cases}\]</p><p>where the normalized associated Legendre functions <span>$\overline{\mathrm{P}}_{\ell}^{m}(x)$</span> are defined in ordinary Legendre polynomials <span>$\mathrm{P}_{\ell}(x)$</span>  as (compare §14.6 and §14.7 of <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>)</p><p class="math-container">\[\overline{\mathrm{P}}_{\ell}^{m}(x)
=
\begin{cases}
\sqrt{\dfrac{(2\ell+1)(\ell-m!)}{2(\ell+m)!}}
(-1)^m
\,
(1-x^2)^{m/2}
\, \dfrac{\mathrm{d}^m \mathrm{P}_{\ell}(x)}{\mathrm{d}^m} &amp; m\geq 0\\[2em]
(-1)^m  \overline{\mathrm{P}}_{\ell}^{-m}(x) &amp; m&lt;0\, .
\end{cases}\]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Different sign conventions are used by different authors when the normalized associated Legendre functions are defined. Conventions may differ by a sign-factor of <span>$(-1)^m$</span> (this factor is often called <em>Condon-Shortley phase factor</em>). We follow the sign convention of <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>, which includes the Condon-Shortley phase factor of <span>$(-1)^m$</span> in the definition of the normalized associated Legendre functions for positive <span>$m$</span>. The main reference <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> for our implementation does not include the phase factor in the definition for the associated Legendre functions, but includes an explicit <span>$(-1)^m$</span>-term to the definition of the mode functions (which we don&#39;t do), such that in the end, our definition of the final mode functions coincides with the definition used in <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>.</p></div></div><hr/><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>A straightforward implementation of the above definition for the normalized associated Legendre functions will fail already for moderately large mode orders <span>$\ell$</span> due to the involved factorials. A more sensible definition is based on recurrence relations<sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup></p></div></div><hr/><h2 id="spherical_orthogonality"><a class="docs-heading-anchor" href="#spherical_orthogonality">Orthogonality Relations of Spherical Vector-Mode Functions</a><a id="spherical_orthogonality-1"></a><a class="docs-heading-anchor-permalink" href="#spherical_orthogonality" title="Permalink"></a></h2><p>The tangential components of the spherical vector-mode functions are orthogonal on concentric spherical surfaces (centered at the coordinate origin). Concretely, they fulfill the orthogonality properties</p><p class="math-container">\[\int \limits_{0}^{2\pi}
\int \limits_{0}^{\pi}
  \bm{F}_{s\ell m}^{(c)}(r,\vartheta, \varphi) \bigg\rvert_{\mathrm{tan}}
\,\cdot\,
\bm{F}_{\sigma \lambda \mu}^{(\gamma)}(r,\vartheta, \varphi) \bigg\rvert_{\mathrm{tan}}
\, 
\sin \vartheta\,
\mathrm{d}\vartheta
\mathrm{d}\varphi
= 
\delta_{s\sigma}\, 
\delta_{\ell \lambda}\, 
\delta_{m, -\mu}\,
R_{s\ell}^{(c)}(k_0r)\,
R_{\sigma\\lambda}^{(\gamma)}(k_0r)\,,\]</p><p>where</p><p class="math-container">\[\delta_{\ell \lambda}
=
\begin{cases}
1 &amp; \text{if } \ell= \lambda \\
0 &amp; \text{if } \ell\neq \lambda
\end{cases}\]</p><p>is the Kronecker-Delta and</p><p class="math-container">\[R_{s\ell}^{(c)}(k_0r)
= \begin{cases}
z_{\ell}^{(c)}(k_0r) &amp; \text{if } s=1 \\[1em]
\dfrac{1}{k_0r}\, \dfrac{\mathrm{d}}{\mathrm{d} k_0r} \left\{z_{\ell}^{(c)}(k_0r)\right\} &amp; \text{if } s=2
\end{cases}\]</p><p>is a short-hand notation for the radial dependency of the corresponding spherical vector-mode function <span>$\bm{F}_{s\ell m}^{(c)}(r,\vartheta, \varphi)$</span>.</p><p>The orthogonality relations are very useful to find the coefficients <span>$\alpha_{s\ell m}^{(c)}$</span> in the spherical vector-wave expansion of a certain field which is known on a spherical surface.</p><h2 id="spherical_farfield"><a class="docs-heading-anchor" href="#spherical_farfield">Far-Field Expressions</a><a id="spherical_farfield-1"></a><a class="docs-heading-anchor-permalink" href="#spherical_farfield" title="Permalink"></a></h2><p>Due to the asymptotic behavior of the radial dependencies </p><p class="math-container">\[\lim \limits_{k_0r \rightarrow \infty} \mathrm{h}_\ell^{(2)}(k_0r) = \mathrm{j}^{\ell+1} \dfrac{\mathrm{e}^{-\mathrm{j} k_0r}}{k_0r} \]</p><p class="math-container">\[\lim \limits_{k_0r \rightarrow \infty}  \dfrac{1}{k_0r} \dfrac{\mathrm{d}}{\mathrm{d} k_0r} \left\{k_0 r \mathrm{h}_\ell^{(2)}(k_0r) \right\} = \mathrm{j}^{\ell} \dfrac{\mathrm{e}^{-\mathrm{j} k_0r}}{k_0r} \]</p><p>for distances approaching infinity, it is convenient to define far-field expressions of the mode functions as</p><p class="math-container">\[\bm{K}_{1\,\ell m}^{(4)}(\vartheta, \varphi) =
\lim \limits_{k_0r \rightarrow \infty}
\dfrac{k_0r}{\mathrm{e}^{-\mathrm{j} k_0r}}
\bm{F}_{1\,\ell m}^{(4)}(r,\vartheta, \varphi)\]</p><p class="math-container">\[\bm{K}_{2\,\ell m}^{(4)}(\vartheta, \varphi) =
\lim \limits_{k_0r \rightarrow \infty}
\dfrac{k_0r}{\mathrm{e}^{-\mathrm{j} k_0r}}
\bm{F}_{2\,\ell m}^{(4)}(r,\vartheta, \varphi)\, .\]</p><p>Explicit expressions for the far-field mode functions are given as</p><p class="math-container">\[\bm{K}_{1\,\ell m}^{(4)}(\vartheta, \varphi) =
\dfrac{\mathrm{j}^{\ell+1}}{\sqrt{\ell(\ell+1)}}
\dfrac{\mathrm{e}^{\, \mathrm{j}m\varphi}}{\sqrt{2\pi}}
\left(
\dfrac{\mathrm{j}m\, \overline{\mathrm{P}}_{\ell}^m(\cos \vartheta )}{\sin \vartheta} \bm{e}_\vartheta
-
\dfrac{\mathrm{d} \overline{\mathrm{P}}_{\ell}^m(\cos \vartheta )}{\mathrm{d} \vartheta} \bm{e}_\varphi  
\right)\]</p><p class="math-container">\[\bm{K}_{2\,\ell m}^{(4)}(\vartheta, \varphi) =
\dfrac{\mathrm{j}^{\ell}}{\sqrt{\ell(\ell+1)}}
\dfrac{\mathrm{e}^{\, \mathrm{j}m\varphi}}{\sqrt{2\pi}}
\left(
\dfrac{\mathrm{d} \overline{\mathrm{P}}_{\ell}^m(\cos \vartheta )}{\mathrm{d} \vartheta} \bm{e}_\vartheta
+
\dfrac{\mathrm{j}m\, \overline{\mathrm{P}}_{\ell}^m(\cos \vartheta )}{\sin \vartheta}
 \bm{e}_\varphi  
\right)\, .\]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This definition of the far-field mode functions lacks the arbitrary factor of <span>$\sqrt{4\pi}$</span> which is introduced in <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> .</p></div></div><hr/><p>Naturally, the far field <span>$\bm{F}(\vartheta, \varphi) = \lim \limits_{k_0r \rightarrow \infty} \dfrac{r}{\mathrm{e}^{-\mathrm{j} k_0r}} \bm{E}(r,\vartheta, \varphi)$</span> can be calculated from a given set of expansion coefficients <span>$\alpha_{s\ell m}^{(4)}$</span> as</p><p class="math-container">\[\bm{F}(\vartheta, \varphi) =
\sqrt{Z_{\mathrm{F}}}
\sum \limits_{c}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{\infty}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(4)}\,
\bm{K_{s\ell m}^{(c)}}(\vartheta, \varphi)\, .\]</p><h2 id="Spherical-Expansion-Coefficients-from-a-Current-Density"><a class="docs-heading-anchor" href="#Spherical-Expansion-Coefficients-from-a-Current-Density">Spherical Expansion Coefficients from a Current Density</a><a id="Spherical-Expansion-Coefficients-from-a-Current-Density-1"></a><a class="docs-heading-anchor-permalink" href="#Spherical-Expansion-Coefficients-from-a-Current-Density" title="Permalink"></a></h2><p>The radiating spherical vector-wave expansion for the fields radiated by arbitrary electric and magnetic volume current densities <span>$\bm{J}(\bm{r})$</span> and <span>$\bm{M}(\bm{r})$</span> can be calculated by </p><p class="math-container">\[\alpha_{s\ell m}^{(4)}=k_0\, (-1)^{m+1} 
\iiint 
\left[
\sqrt{Z_{\mathrm{F}}}\, \bm{F}_{s,\ell,-m}^{(1)} \cdot  \bm{J}(\bm{r})
-
\dfrac{\mathrm{j}}{\sqrt{Z_{\mathrm{F}}}}(\bm{r})\, \bm{F}_{3-s,\ell,-m}^{(1)}(\bm{r}) \cdot  \bm{M}(\bm{r})
\right] 
\mathrm{d}v \, .\]</p><p>The spherical vector-wave functions <span>$\bm{F}_{s\ell m}^{(1)}(\bm{r})$</span> of incident type which are involved in the above calculation have vanishingly small magnitudes for locations <span>$\bm{r}$</span> with distance to the coordinate origin <span>$r &lt; \ell /k_0$</span>. Thus, for current densities which are completely enclosed by a minimum sphere of radius <span>$r_{\mathrm{minsphere}}$</span>, one may neglect all coefficients <span>$\alpha_{s\ell m}^{(4)}$</span> with <span>$\ell &lt; k_0 r_{\mathrm{minsphere}}$</span> (plus a small buffer depending on the desired accuracy), as long as one is not interested in evaluating the expanded electromagnetic fields extremely close to the original currents. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The physical size of the current distribution dictates the maximum degree <span>$\ell$</span> of the spherical wave expansion to accurately characterize the radiated fields.</p></div></div><hr/><h2 id="spherical_coefficients_orthogonality"><a class="docs-heading-anchor" href="#spherical_coefficients_orthogonality">Spherical Expansion Coefficients by Using Orthogonality</a><a id="spherical_coefficients_orthogonality-1"></a><a class="docs-heading-anchor-permalink" href="#spherical_coefficients_orthogonality" title="Permalink"></a></h2><p>Often, we are interested in finding the spherical vector-wave expansion of a purely incident or a purely radiated field. To be precise, one wants to find the expansion coefficients <span>$\alpha_{s\ell m}^{(c)}$</span> (with <span>$c=1$</span> for a purely incident field and <span>$c=4$</span> for a purely radiated field) to fulfill the equality</p><p class="math-container">\[\bm{E}(r, \vartheta, \varphi) =
k_0 \, \sqrt{Z_{\mathrm{F}}}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{\infty}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(c)}\,
\bm{F}_{s\ell m}^{(c)}(r,\vartheta, \varphi)\]</p><p>for a given field <span>$\bm{E}(r, \vartheta, \varphi)$</span>.</p><p>As indicated <a href="#spherical_orthogonality">previously</a>, one may leverage on the orthogonality properties of the spherical vector-wave functions to find the desired expansion coefficients <span>$\alpha_{s\ell m}^{(c)}$</span>. We have</p><p class="math-container">\[\alpha_{s\ell m}^{(c)}
   =
   \dfrac{(-1)^{m}}{k_0\sqrt{Z_{\mathrm{F}}}\,R_{s\ell}^{(c)}(k_0r)\,
     R_{s\ell}^{(\gamma)}(k_0r)}
\int \limits_{0}^{2\pi}
\int \limits_{0}^{\pi}
  \bm{E}(r,\vartheta, \varphi) \bigg\rvert_{\mathrm{tan}}
\,\cdot\,
\bm{F}_{s \ell ,-m}^{(\gamma)}(r,\vartheta, \varphi) \bigg\rvert_{\mathrm{tan}}
\, 
\sin \vartheta\,
\mathrm{d}\vartheta
\mathrm{d}\varphi\, .\]</p><p>The above formula for finding the spherical coefficients <span>$\alpha_{s\ell m}^{(c)}$</span> is valid at any radial distance <span>$r$</span> from the origin. In particular, the formula can also be used to find the coefficients <span>$\alpha_{s\ell m}^{(c)}$</span> from the radiated fields at far-field distance.</p><h2 id="spherical_incident_expansion"><a class="docs-heading-anchor" href="#spherical_incident_expansion">Number of Relevant Modes of an Incident Electromagnetic Field</a><a id="spherical_incident_expansion-1"></a><a class="docs-heading-anchor-permalink" href="#spherical_incident_expansion" title="Permalink"></a></h2><p>In a source-free region around the coordinate origin, incident fields can be completely described in terms of vector spherical wave functions <span>$\bm{F}_{s\ell m}^{(1)}(\bm{r})$</span> of incident type by (accordingly for the H-field)</p><p class="math-container">\[\bm{E}(r, \vartheta, \varphi) =
k_0 \, \sqrt{Z_{\mathrm{F}}}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{\infty}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(1)}\,
\bm{F}_{s\ell m}^{(1)}(r,\vartheta, \varphi)\,.\]</p><p>The spherical vector-wave functions <span>$\bm{F}_{s\ell m}^{(1)}(\bm{r})$</span> of incident type which are involved in the above calculation have vanishingly small magnitudes for locations <span>$\bm{r}$</span> with distance to the coordinate origin <span>$r &lt; \ell /k_0$</span>. Thus, as long as one is interested only in the fields inside a spherical region around the origin with radius <span>$r_{\mathrm{observation}}$</span>, it is sufficient to consider only modes with <span>$\ell &lt; L = k_0 r_{\mathrm{observation}}$</span> (plus a small buffer depending on the desired accuracy).  We have</p><p class="math-container">\[\bm{E}(r, \vartheta, \varphi)\,\bigg\lvert_{r&lt; \ell/k_0} \approx
k_0 \, \sqrt{Z_{\mathrm{F}}}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{L}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(1)}\,
\bm{F}_{s\ell m}^{(1)}(r,\vartheta, \varphi) \,.\]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The physical size of the observation region around the coordinate origin dictates the maximum degree <span>$\ell$</span> of the spherical wave expansion to accurately characterize the incident fields.</p></div></div><hr/><h2 id="spherical_translation"><a class="docs-heading-anchor" href="#spherical_translation">Translation of Radiated Modes into Incident Modes in Different Coordinate System</a><a id="spherical_translation-1"></a><a class="docs-heading-anchor-permalink" href="#spherical_translation" title="Permalink"></a></h2><p>The radiated electromagnetic fields generated by currents around the coordinate origin may be represented by a superposition of spherical vector-wave functions <span>$\bm{F}_{s\ell m}^{(4)}(r, \vartheta, \varphi)$</span> of radiated type. However, in a translated coordinate system (denoted by the primed coordinates <span>$r&#39;, \vartheta&#39;, \varphi&#39;$</span>), the sources are far away from the new coordinate origin and the electromagnetic fields around the new origin may be represented in terms of spherical vector-wave functions <span>$\bm{F}_{s\ell m}^{(1)}(r&#39;, \vartheta&#39;, \varphi&#39;)$</span> of incident type with respect to the new coordinate origin. The geometrical situation is depicted in the figure below.</p><figure>
<picture>
  <source media="(prefers-color-scheme: dark)" srcset="../assets/SphericalTranslation_dark.svg" width="500">
  <source media="(prefers-color-scheme: light)" srcset="../assets/SphericalTranslation.svg" width="500" >
  <img alt="" src="" width="200">
</picture>

  <figcaption>
    Schematic of the geometry for the translation of radiated modes into incident modes in a different coordinate system.
  </figcaption>
</figure>
<br/><p>The expansion coefficients <span>$\alpha_{\sigma \lambda \mu}^{(1)}$</span> of the incident field in the new coordinate system can be calculated from the expansion coefficients <span>$\alpha_{s\ell m}^{(4)}$</span> of the radiated field in the original coordinate system by</p><p class="math-container">\[   \alpha_{\sigma \lambda \mu}^{(1)}
   = 
   \sum \limits_{s,\ell, m}
   \mathcal{T}_{s\ell m}^{\sigma \lambda \mu}(\bm{R})\,
    \alpha_{s\ell m}^{(4)}\]</p><p>where the translation coefficient <span>$\mathcal{T}_{s\ell m}^{\sigma \lambda \mu}(\bm{R})$</span> is given by</p><p class="math-container">\[\mathcal{T}_{s\ell m}^{\sigma \lambda \mu}(\bm{R})
=
-
  \sum \limits_{\ell&#39;=0}^\infty
  (-1)^{\sigma + \lambda +\mu}
  \int \limits_{0}^{2\pi}
\int \limits_{0}^{\pi}
  (-\mathrm{j})^{\ell&#39;}
  \left(
  2\ell&#39;+1
  \right)
    {\mathrm{h}_{\ell&#39;}^{(2)}}\left({k_0\lvert{\bm{R}}\rvert}\right)\,
  {\mathrm{P}_{\ell&#39;}}\left({\hat{\bm{k}}\left(\vartheta, \varphi\right) \cdot\hat{\bm{R}}}\right)\,  
  {\bm{K}_{s\ell m}^{(4)}}\left(\vartheta, \varphi\right)
  \cdot
  {\bm{K}_{\sigma, \lambda,- \mu}^{(4)}}\left(\vartheta, \varphi\right) 
  \, \sin \vartheta 
  \mathrm{d}\vartheta\, \mathrm{d}\varphi\, ,\]</p><p>where <span>$\hat{\bm{k}}\left(\vartheta, \varphi\right)$</span> denotes the radial unit vector defined by the angles <span>$\vartheta, \varphi$</span> and <span>$\hat{\bm{R}}$</span> denotes the unit vector in the direction of the vector from the original coordinate origin to the new coordinate origin.</p><h2 id="Received-Signal"><a class="docs-heading-anchor" href="#Received-Signal">Received Signal</a><a id="Received-Signal-1"></a><a class="docs-heading-anchor-permalink" href="#Received-Signal" title="Permalink"></a></h2><p>Let <span>$\hat{\alpha}_{s\ell m}^{(c)}$</span> be the normalized expansion coefficients for the fields radiated by an antenna such that <span>$\alpha_{s\ell m}^{(c)}=  a\,\hat{\alpha}_{s\ell m}^{(c)}$</span> are the actual expansion coefficients when the antenna&#39;s transmit port is excited by a signal with wave amplitude <span>$a \in \mathbb{C} \, \sqrt{\mathrm{W}}$</span>. To determine the received signal <span>$b \in \mathbb{C} \, \sqrt{\mathrm{W}}$</span> of this antenna in receive mode under a certain illumination of an incident field, it is convenient to represent the incident field via its spherical vector wave expansion</p><p class="math-container">\[\bm{E}(r, \vartheta, \varphi)=
k_0 \, \sqrt{Z_{\mathrm{F}}}
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{L}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(1)}\,
\bm{F}_{s\ell m}^{(1)}(r,\vartheta, \varphi) \,.\]</p><p>In this case, the received signal is given by</p><p class="math-container">\[b=
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{L}
\sum \limits_{m=-\ell}^{\ell}
\alpha_{s\ell m}^{(1)}\,
\hat{\beta}_{s\ell m}, ,\]</p><p>where the antenna receive coefficients <span>$\hat{\beta}_{s\ell m}$</span> are found from the corresponding normalized antenna&#39;s transmit coefficients <span>$\hat{\alpha}_{s\ell m}^{(c)}$</span> via</p><p class="math-container">\[\hat{\beta}_{s\ell m}
=
\dfrac{(-1)^{m}}{2}
\hat{\alpha}_{s\ell,-m}^{(c)}\, .\]</p><p>Combining this result with the findings from the <a href="#spherical_translation">section above</a>, we can express the <span>$S_{21}$</span> parameter measured for the transmission between two antennas as</p><p class="math-container">\[S_{21}
=
\sum \limits_{\sigma=1}^2
\sum \limits_{\lambda=1}^{L}
\sum \limits_{\mu=-\lambda}^{\lambda}
\hat{\beta}_{\sigma \lambda \mu}^{\text{antenna2}}
\,
\left(
\sum \limits_{s=1}^2
\sum \limits_{\ell=1}^{L}
\sum \limits_{m=-\ell}^{\ell}
   \mathcal{T}_{s\ell m}^{\sigma \lambda \mu}(\bm{R})\,
    \hat{\alpha}_{s\ell m}^{(4),\text{antenna1}}
\right)\]</p><p>where <span>$\hat{\alpha}_{s\ell m}^{(4),\text{antenna1}}$</span> are the normalized transmit coefficients of antenna 1 (the transmit antenna), <span>$\hat{\beta}_{\sigma \lambda \mu}^{\text{antenna2}}$</span> are the receive coefficients of antenna 2 (the receive antenna) and <span>$\mathcal{T}_{s\ell m}^{\sigma \lambda \mu}(\bm{R})$</span> is the translation operator known from <a href="#spherical_translation">previous sections</a> with <span>$\bm{R}$</span> denoting the vector separating the centers of the two antennas. The geometric situation for the calculation of the <span>$S_{21}$</span>-parameter is depicted below. </p><figure>
<picture>
  <source media="(prefers-color-scheme: dark)" srcset="../assets/S21Translation_dark.svg" width="500">
  <source media="(prefers-color-scheme: light)" srcset="../assets/S21Translation.svg" width="500" >
  <img alt="" src="" width="200">
</picture>

  <figcaption>
    The geometric situation for the calculation of the transmission between two antennas.
  </figcaption>
</figure>
<br/><hr/><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="https://dlmf.nist.gov/">F. W. J. Olver and National Institute of Standards and Technology (U.S.), eds., &quot;<em>NIST Handbook of Mathematical Functions</em>&quot;, Cambridge ; New York: Cambridge University Press : NIST, 2010</a>.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>J. E. Hansen, ed., <em>Spherical Near-Field Antenna Measurements</em>, The Institution of Engineering and Technology, Michael Faraday House, Six Hills Way, Stevenage SG1 2AY, UK: IET, 1988.</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>J. A. Stratton, &quot;<em>Electromagnetic Theory</em>&quot;, McGraw-Hill, 1st ed. International series in pure and applied physics, OCLC: 536704, New York, 1941.</li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a><a href="https://arxiv.org/abs/1410.1748">T. Limpanuparb, J. Milthorpe: &quot;Associated Legendre Polynomials and Spherical Harmonics Computation for Chemistry Applications&quot;, arXiv 2014</a>.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../dipoles/dipole_theory/">« Dipoles</a><a class="docs-footer-nextpage" href="../../planewaves/planewave_theory/">Plane Wave Expansion »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 20 September 2024 21:39">Friday 20 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
